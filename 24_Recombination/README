################################################################################
# Thoughts
################################################################################
Recombination rates is more likely influenced by the meiotic crossover genome
organisation. But if we argue that likely persistent contacts will exist in
meiotic genome conformation, the recombination rate vs. Cp association makes sense.
Initially, we hypothesized that persistent contacts with high contact strength
will have higher recombination  rates but one can argue that perhaps persistent
regions have evolved to have lower meiotic recombination rates to preserve their
sequence similarity? We do see that recombination rate slightly decrease with Cp.
All speculative though. I think I will leave this out in my thesis.
################################################################################
# LIBRARIES & DEPENDANCES * LIBRARIES & DEPENDANCIES * LIBRARIES & DEPENDANCES *
################################################################################
PERSIST.MX
~/Database/recomRates_2011-01_phaseII_B37_Myers/

library(data.table)
library(foreach)
library(itertools)
library(doParallel)
library(GenomicRanges)
library(compiler)

source(paste0(lib, "/TrantoRextr/GEN_WhichOverlap.R"))
source(paste0(lib, "/loadRData.R"))
source(paste0(lib, "/mapToHiCcontactPersistBins.R")) 
source(paste0(lib, "/UTL_doPar.R"))
source(paste0(wk.dir, "/lib/ijconsensusFUN.R"))
################################################################################
# Recombination rate vs. Cp
################################################################################
1. Determine which SNPs overlap with each 40-kb bin and attach the rate info
mapToHiCcontactPersistBins(). Bins populated with NA have no overlapping SNP.
Liftover not needed because recombination rates already lifed to GRCh37/hg19 by
the source paper (Munch et al., 2014).
The starting data only listed a position (1 bp coordinate) and I assummed this to
be the 1-based position of the SNP then generated 0-based BED files out of this
data and these BED were inputted to mapToHiCcontactPersistBins(). 

Output: FEATURE.BIN.MX

V4 - SNP_<index in BED, this column was added when BED was generated>
V5 - Rate(cM/Mb)
V6 - Map(cM)

2. Determine consensus rate for each contact based on consensus.method. 

Only consider contacts with both bins having overlapping SNPs because I'm not so
sure how to interpret bins without overlapping SNP. Cases not satisying this
will have NA rate in output, IJ.RATES. The _v1 outputs did not mark with NA
those cases with only 1 bin having missing value. The second run yields the final
objects with all these cases marked as NA in IJ.RATES.

IJ.RATES is an atomic vector of rates per contact per Cp. It follows the order of
contacts in PERSIST.MX after subsetting for the Cp. 

How consensus.method works. If consensus.method is MEDIAN.MEAN the ijconsensusFUN()
will take the median of i bin rates and take median of j bin rates 
then take mean of the two medians. This can work for mean, sd, min and max. For 
now I hardcoded in ijconsensusFUN() that NAs will be removed (na.rm=T). If the
consensus method starts with C as in C.MEAN, the function will pool (C as in c())
i and j bin  rates then take the mean of the pooled rates. Same as above
the second method is hardcoded to remove NAs. 

3. Plot rates from all chr vs. Cp. Title includes count of rates from valid contacts
per Cp. The BOX.STAT object contains boxplot statistics per Cp generated by
boxplot.stats(defaults) (22 JUL 2022) plus mean, min and max with NAs removed.
################################################################################
