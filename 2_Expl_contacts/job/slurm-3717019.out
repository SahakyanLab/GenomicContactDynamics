Loading R-cbrg/current
  Loading requirement: gsl/2.6 hdf5/1.10.7 gdal/3.2.1 sqlite/3.35.0 proj/7.2.1
    geos/3.9.0 jags/4.3.0

R version 4.1.2 (2021-11-01) -- "Bird Hippie"
Copyright (C) 2021 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> ################################################################################
> # Count all Hi-C contacts (both short and long-range) per tissue per chr using 
> # MELT.MX.
> ################################################################################
> # FLAGS * FLAGS * FLAGS * FLAGS * FLAGS * FLAGS * FLAGS * FLAGS * FLAGS * FLAGS
> ### DIRECTORY STRUCTURE ########################################################
> whorunsit = "LiezelCluster" # "LiezelMac", "LiezelCluster", "LiezelLinuxDesk",
> # "AlexMac", "AlexCluster"
> 
> if( !is.null(whorunsit[1]) ){
+   # This can be expanded as needed ...
+   if(whorunsit == "LiezelMac"){
+     home.dir = "/Users/ltamon" 
+     wk.dir = paste0(home.dir, "/SahakyanLab/GenomicContactDynamics/2_Expl_contacts")
+   } else if(whorunsit == "LiezelCluster"){
+     home.dir = "/project/sahakyanlab/ltamon"
+     wk.dir = paste0(home.dir, "/DPhil/GenomicContactDynamics/2_Expl_contacts")
+   } else {
+     print("The supplied <whorunsit> option is not created in the script.", quote=FALSE)
+   }
+ }
> data.dir = paste0(home.dir, "/Database")
> # MELT.MX directory
> melt.dir = paste0(data.dir, "/GSE87112/combined_contacts/RAW_primary_cohort")
> out.dir = paste0(wk.dir, "/out_countALLcontacts")
> ### OTHER SETTINGS #############################################################
> chr.v = paste("chr", c(1:22, "X"), sep="") 
> ################################################################################
> # LIBRARIES & DEPENDANCES * LIBRARIES & DEPENDANCIES * LIBRARIES & DEPENDANCES *
> ################################################################################
> ################################################################################
> # MAIN CODE * MAIN CODE * MAIN CODE * MAIN CODE * MAIN CODE * MAIN CODE *
> ################################################################################
> MX <- sapply(X=chr.v, simplify=FALSE, FUN=function(chr){
+   
+   # Load MELT.MX
+   load(paste0(melt.dir, "/human_", chr, "_allcontacts.RData"))
+   
+   # Count contacts per cell line/tissue
+   out <- apply(X=MELT.MX$upper.tri[,-(1:2)], MARGIN=2, FUN=function(x){
+     sum(x!=0)
+   })
+   
+   if(all( rowSums(MELT.MX$upper.tri[,-(1:2)]) > 0 )){
+     out <- c(out, allCT=nrow(MELT.MX$upper.tri))
+   } else {
+     stop(paste0(chr, ": Contact/s not present in any dataset."))
+   }
+   
+   rm(MELT.MX); gc()
+   
+   print(paste(chr, " done!"), quote=FALSE)
+   
+   return(out)
+   
+ })
[1] chr1  done!
[1] chr2  done!
[1] chr3  done!
[1] chr4  done!
[1] chr5  done!
[1] chr6  done!
[1] chr7  done!
[1] chr8  done!
[1] chr9  done!
[1] chr10  done!
[1] chr11  done!
[1] chr12  done!
[1] chr13  done!
[1] chr14  done!
[1] chr15  done!
[1] chr16  done!
[1] chr17  done!
[1] chr18  done!
[1] chr19  done!
[1] chr20  done!
[1] chr21  done!
[1] chr22  done!
[1] chrX  done!
> 
> MX <- do.call("rbind", MX)
> MX <- rbind(MX, chrALL=colSums(x=MX))
> 
> write.csv(x=MX, file=paste0(out.dir, "/HiCallcontactsCount.csv"),
+           row.names=TRUE, quote=FALSE) 
> 
> # rm(list=ls()); gc()
> 
CBB Profiling started Mon Jan 24 08:38:28 2022
SLURM_JOB_ID		3717019
REQ_CPU_CORES		1
REQ_MEMORY_GB		20.000000
Starting profiling...

                                                                                
                                                                                
                                    CPU (cores)                                 
    1 +---------------------------------------------------------------------+   
      | ###  ###        +       +        +        +        +       + #      |   
      |##                                                            #      |   
      |#                                                             #      |   
      |#                                                             #      |   
  0.8 |#+                                                            #    +-|   
      |#                                                             #      |   
      |                                                              #      |   
      |                                                              #      |   
  0.6 |-+                                                            #    +-|   
      |                                                              #      |   
      |                                                              #      |   
      |                                                              #      |   
      |                                                              #      |   
  0.4 |-+                                                            #    +-|   
      |                                                              #      |   
      |                                                              #      |   
      |                                                              #      |   
  0.2 |-+                                                            #    +-|   
      |                                                              #      |   
      |                                                              #      |   
      |                                                              #      |   
      |        +        +       +        +        +        +       + #      |   
    0 +---------------------------------------------------------------------+   
      0        50      100     150      200      250      300     350      400  
                                Job profiling step                              
                                                                                

                                                                                
                                                                                
                                   Memory (GB)                                  
  20 +----------------------------------------------------------------------+   
     |        +        +        +        +       +        +        +        |   
  18 |-+                                                                  +-|   
     |                                                                      |   
     |                                                                      |   
  16 |-+                                                                  +-|   
     |                                                                      |   
  14 |-+                #                                                 +-|   
     |                 ##                                                   |   
  12 |-+               ##                                                 +-|   
     |          #     ###                                                   |   
  10 |-+      ###    ####   ##                                            +-|   
     |        ###    #  #   ##                                              |   
     |        # #    #  #   ##  ###                                         |   
   8 |-+      # #    #  #   ##  ###   #                                   +-|   
     |       ## #   #   #   ##  ### ###  ##                                 |   
   6 |-+     #  #   #   #  # #  # # ###  ##     #                    #    +-|   
     |     ###  # ###   #  # #  # # # # # # #   #   #  # #          ##      |   
   4 |-+  ##    ##      #  # #  # # # # # # ## ## ### ####          ##    +-|   
     |  ###     ##      # ## #### # # ### # ## ##### ######         ##      |   
     | ##       #       ###       ###     ## ####### ############### #      |   
   2 |##                                                             #    +-|   
     |#       +        +        +        +       +        +        + #      |   
   0 +----------------------------------------------------------------------+   
     0        50      100      150      200     250      300      350      400  
                               Job profiling step                               
                                                                                

                                                                                
                                                                                
                                  Data read (GB)                                
  1.6 +---------------------------------------------------------------------+   
      |        +        +       +        +        +        +       +        |   
      |                                                                     |   
  1.4 |-+                                                        #####    +-|   
      |                                                        ###   #      |   
      |                                                     ####     #      |   
  1.2 |-+                                                ####        #    +-|   
      |                                               ####           #      |   
      |                                            ####              #      |   
    1 |-+                                        ###                 #    +-|   
      |                                       ####                   #      |   
  0.8 |-+                                  ####                      #    +-|   
      |                                 ####                         #      |   
      |                             ####                             #      |   
  0.6 |-+                          ##                                #    +-|   
      |                        #####                                 #      |   
      |                     ####                                     #      |   
  0.4 |-+                 ###                                        #    +-|   
      |             #######                                          #      |   
      |           ###                                                #      |   
  0.2 |-+        ##                                                  #    +-|   
      |  #########                                                   #      |   
      |###     +        +       +        +        +        +       + #      |   
    0 +---------------------------------------------------------------------+   
      0        50      100     150      200      250      300     350      400  
                                Job profiling step                              
                                                                                

                                                                                
                                                                                
                                  Data written (GB)                             
  6e-05 +-------------------------------------------------------------------+   
        |        +       +        +       +        +       +        +       |   
        |                                                                   |   
        |                                                            #      |   
  5e-05 |-+                                                      #####    +-|   
        |                                                     ####   #      |   
        |                                                 ####       #      |   
        |                                             #####                 |   
  4e-05 |-+                                        ####                   +-|   
        |                                      #####                        |   
        |                                   ####                            |   
  3e-05 |-+                             ####                              +-|   
        |                           #####                                   |   
        |                        ####                                       |   
        |                    #####                                          |   
  2e-05 |-+               ####                                            +-|   
        |             #####                                                 |   
        |         #####                                                     |   
        |      ####                                                         |   
  1e-05 |-+####                                                           +-|   
        |###                                                                |   
        |                                                                   |   
        |        +       +        +       +        +       +        +       |   
      0 +-------------------------------------------------------------------+   
        0        50     100      150     200      250     300      350     400  
                                 Job profiling step                             
                                                                                
